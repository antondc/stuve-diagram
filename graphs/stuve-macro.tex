\newcommand{\stuve}[3]{
  \begin{figure}
    \centering
    \begin{tikzpicture}
      \pgfplotsset{select coords between index/.style 2 args={
            x filter/.code={
                \ifnum\coordindex<##1\def\pgfmathresult{}\fi
                \ifnum\coordindex>##2\def\pgfmathresult{}\fi
              }
          }}

      % BASE HEIGHT
      \begin{axis}[
          xmin=-95,
          xmax=45,
          ymin=95,
          ymax=1020,
          tick style={draw=none},
          ytick={100,200,...,1000},
          yticklabel style={font=\scriptsize,/pgf/number format/.cd, precision=0, relative*=2},
          xticklabel style={font=\scriptsize},
          y dir=reverse,
          grid=both,
          width={#3},
          y coord trafo/.code={\pgfmathparse{##1^0.286}},
          y coord inv trafo/.code={\pgfmathparse{##1^(1/0.286)}},
          xticklabel={\pgfmathparse{int(round(\tick))}\pgfmathprintnumber{\pgfmathresult}°},
          fixed point arithmetic,
          visualization depends on={value \thisrow{altitude}\as\altitude},
          visualization depends on={value \thisrow{pressure}\as\pressure},
        ]
        % LABEL
        \addplot [select coords between index={0}{0},yshift=1.5mm,font=\scriptsize] table [x expr={0}, y=pressure, col sep=comma] {#1} node [right] at (axis cs:-95,\pressure) {\pgfmathprintnumber{\altitude} \space m.};
        % LINE
        \addplot [select coords between index={0}{0},opacity=0.7,yshift=-0.3] table [x expr={0}, y=pressure, col sep=comma] {#1} node {———————————————————————————————————————————————————————————————————};
      \end{axis}

      % DEW POINT
      \begin{axis}[
          xmin=-95,
          xmax=45,
          ymin=95,
          ymax=1020,
          tick style={draw=none},
          ytick={100,200,...,1000},
          yticklabel style={font=\scriptsize,/pgf/number format/.cd, precision=0, relative*=2},
          xticklabel style={font=\scriptsize},
          y dir=reverse,
          xticklabel={\pgfmathparse{int(round(\tick))}\pgfmathprintnumber{\pgfmathresult}°},
          grid=both,
          width={#3},
          y coord trafo/.code={\pgfmathparse{##1^0.286}},
          y coord inv trafo/.code={\pgfmathparse{##1^(1/0.286)}},
          fixed point arithmetic,
        ]
        \addplot [thick, densely dotted] table [x=dew_point, y=pressure, col sep=comma] {#1};
      \end{axis}

      % TEMPERATURE
      \begin{axis}[
          xmin=-95,
          xmax=45,
          ymin=95,
          ymax=1020,
          tick style={draw=none},
          ytick={100,200,...,1000},
          yticklabel style={font=\scriptsize,/pgf/number format/.cd, precision=0, relative*=2},
          xticklabel style={font=\scriptsize},
          xticklabel={\pgfmathparse{int(round(\tick))}\pgfmathprintnumber{\pgfmathresult}°},
          y dir=reverse,
          grid=both,
          width={#3},
          y coord trafo/.code={\pgfmathparse{##1^0.286}},
          y coord inv trafo/.code={\pgfmathparse{##1^(1/0.286)}},
          fixed point arithmetic,
        ]
        \addplot [thick] table [x=temperature, y=pressure, col sep=comma] {#1};
      \end{axis}

      % ALTITUDE AXIS
      \begin{axis}[
          ymin=-56,
          ymax=16074,
          xticklabels=\empty,
          scaled ticks=false,
          tick style={draw=none},
          yticklabel style={align=left,font=\scriptsize,/pgf/number format/fixed,text opacity=0.3,xshift=2.2cm},
          ytick={0,1000,2000,...,15000},
          yticklabels={0,1000,2000,...,15000},
          yticklabel={\tiny{\pgfmathprintnumber{\tick}m. \pgfmathparse{int(round(\tick/0.3048))}\pgfmathprintnumber{\pgfmathresult}f.}},
          width={#3},
          % axis y line*=right,
          fixed point arithmetic,
          ytick align=inside,
        ]
        \addplot [opacity=0] coordinates { (1,0)   (1,15000)};
      \end{axis}

      % ADIABATS AXIS
      \begin{axis}[
          xmin=-95,
          xmax=45,
          ymin=3.668,
          ymax=7.2219,
          y dir=reverse,
          ytick={100^0.2854,200^0.2854,300^0.2854,400^0.2854,500^0.2854,600^0.2854,700^0.2854,800^0.2854,900^0.2854,1000^0.2854},
          tick style={draw=none},
          yticklabels=\empty,
          xticklabels=\empty,
          xlabel=\(T\),
          ylabel=\(p (hPa)\),
          width={#3},
          axis y line*=left,
        ]
        \input{graphs/adiabats-lines.tex}
      \end{axis}
    \end{tikzpicture}
    \\
    \textit{#2}
  \end{figure}
}